---
- name: demo app code
  copy:
    src: files/
    dest: "{{ wsid_demo_client_app_installation_dir }}/"
  notify: reload uwsgi
- apt:
    name: 
      - apache2-utils
      - python3
      - python3-pip
      - uwsgi-emperor
      - uwsgi-plugin-python3
      - python3-flask
      - python3-requests
- pip:
    name: 
      - paramiko>=2.2
    executable: pip3
- systemd:
    name: "uwsgi-emperor"
    enabled: yes
    state: started
- name: uwsgi vassal config
  template:
    dest: /etc/uwsgi-emperor/vassals/demo_uwsgi.ini
    src: uwsgi.ini
- name: wsid rotation hook directory
  file:
    dest: "{{ wsid_hooks_key_dir }}/{{wsid_demo_identity}}"
    state: directory
- name: wsid rotation hook 
  template:
    src: hook.sh
    dest: "{{ wsid_hooks_key_dir }}/{{wsid_demo_identity}}/00_uwsgi_reload.sh"
    mode: 0744
